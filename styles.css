/* CRITICAL: Override CSS Variables FIRST - Use calc() to force recalculation */
.always-color-text-highlight {
  --text-normal: var(--highlight-color, currentColor) !important;
  --link-color: var(--highlight-color, currentColor) !important;
  --link-external-color: var(--highlight-color, currentColor) !important;
  --link-unresolved-color: var(--highlight-color, currentColor) !important;
  --link-color-hover: var(--highlight-color, currentColor) !important;
  --link-external-color-hover: var(--highlight-color, currentColor) !important;
  /* Use important on color to override all theme variables */
  color: var(--highlight-color, inherit) !important;
}

/* Override Obsidian's link color variables for elements with our highlights */
.cm-line .always-color-text-highlight,
.cm-content .always-color-text-highlight,
.markdown-preview-view .always-color-text-highlight {
  --link-color: var(--highlight-color, currentColor) !important;
  --link-external-color: var(--highlight-color, currentColor) !important;
  --link-unresolved-color: var(--highlight-color, currentColor) !important;
  --link-color-hover: var(--highlight-color, currentColor) !important;
  --link-external-color-hover: var(--highlight-color, currentColor) !important;
  --text-normal: var(--highlight-color, currentColor) !important;
}

/* Force color inheritance on all link states */
.cm-underline .always-color-text-highlight,
.cm-url .always-color-text-highlight,
.cm-link .always-color-text-highlight,
.internal-link .always-color-text-highlight,
.external-link .always-color-text-highlight {
  color: var(--highlight-color, currentColor) !important;
  text-decoration-color: var(--highlight-color, currentColor) !important;
  --text-normal: var(--highlight-color, currentColor) !important;
}

/* Target the specific Obsidian classes that apply link colors */
.cm-line:not(.cm-active) .cm-underline .always-color-text-highlight {
  color: var(--highlight-color, currentColor) !important;
}

/* Additional specificity for nested link scenarios */
a .always-color-text-highlight,
.cm-link-text .always-color-text-highlight {
  color: var(--highlight-color, currentColor) !important;
  text-decoration: inherit !important;
  border-bottom: inherit !important;
}

/* Ensure highlight styles persist through Obsidian's dynamic rendering */
.always-color-text-highlight {
  /* Prevent Obsidian's underline class from affecting our highlights */
  -webkit-text-decoration-color: var(--highlight-color, currentColor) !important;
  text-decoration-line: inherit !important;
  text-decoration-style: inherit !important;
  text-decoration-thickness: inherit !important;
}

/* LIVE PREVIEW MODE: Override CodeMirror 6 link styling */
.cm-editor .cm-underline.always-color-text-highlight {
  color: var(--highlight-color, currentColor) !important;
  text-decoration: inherit !important;
  -webkit-text-decoration-color: var(--highlight-color, currentColor) !important;
  text-decoration-color: var(--highlight-color, currentColor) !important;
  --text-normal: var(--highlight-color, currentColor) !important;
  --link-color: var(--highlight-color, currentColor) !important;
}

.cm-editor .cm-url.always-color-text-highlight {
  color: var(--highlight-color, currentColor) !important;
  text-decoration: inherit !important;
  --text-normal: var(--highlight-color, currentColor) !important;
}

.cm-editor .cm-link.always-color-text-highlight {
  color: var(--highlight-color, currentColor) !important;
  text-decoration: inherit !important;
  --text-normal: var(--highlight-color, currentColor) !important;
}

.cm-editor .cm-hmd-internal-link.always-color-text-highlight {
  color: var(--highlight-color, currentColor) !important;
  text-decoration: inherit !important;
  --text-normal: var(--highlight-color, currentColor) !important;
}

.cm-editor .cm-link-text.always-color-text-highlight {
  color: var(--highlight-color, currentColor) !important;
  --text-normal: var(--highlight-color, currentColor) !important;
}

/* Double specificity for maximum override */
.cm-content .cm-underline.always-color-text-highlight,
.cm-content .cm-url.always-color-text-highlight,
.cm-content .cm-link.always-color-text-highlight {
  color: var(--highlight-color, currentColor) !important;
  text-decoration: inherit !important;
  --text-normal: var(--highlight-color, currentColor) !important;
}

/* Target active line with specific override */
.cm-line .always-color-text-highlight {
  --link-color: var(--highlight-color, currentColor) !important;
  --link-external-color: var(--highlight-color, currentColor) !important;
  --text-normal: var(--highlight-color, currentColor) !important;
  color: var(--highlight-color, currentColor) !important;
}
